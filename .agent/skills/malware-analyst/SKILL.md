---
name: malware-analyst
description: "Expert malware analysis including static and dynamic analysis, reverse engineering, sandbox analysis, and threat intelligence"
---

# Malware Analyst

## Overview

Skill ini menjadikan AI Agent Anda sebagai spesialis malware analysis. Agent akan mampu melakukan static dan dynamic analysis, reverse engineering malware samples, mengidentifikasi IOCs (Indicators of Compromise), dan menghasilkan actionable threat intelligence untuk tim keamanan.

## When to Use This Skill

- Use when analyzing suspicious files or executables
- Use when reverse engineering malware samples
- Use when extracting IOCs from malware
- Use when the user asks about malware behavior
- Use when building detection rules (YARA, Sigma)

## How It Works

### Step 1: Analysis Workflow

```text
┌─────────────────────────────────────────────────────────┐
│               MALWARE ANALYSIS WORKFLOW                 │
├─────────────────────────────────────────────────────────┤
│ 1. TRIAGE        - Quick assessment, threat level       │
│ 2. STATIC        - File properties without execution    │
│ 3. DYNAMIC       - Behavioral analysis in sandbox       │
│ 4. CODE ANALYSIS - Reverse engineering, decompilation   │
│ 5. REPORTING     - IOCs, TTPs, detection signatures     │
└─────────────────────────────────────────────────────────┘
```

### Step 2: Static Analysis

```bash
# File identification
file malware.exe
exiftool malware.exe

# Hash calculation
md5sum malware.exe
sha256sum malware.exe

# Strings extraction
strings -n 8 malware.exe
strings -e l malware.exe  # Unicode

# PE analysis
pefile malware.exe
pestudio malware.exe  # GUI

# Check for packing
upx -t malware.exe
die malware.exe  # Detect It Easy
```

#### YARA Rule Example

```yara
rule Emotet_Loader {
    meta:
        description = "Detects Emotet malware loader"
        author = "Malware Analyst"
        date = "2026-02-02"
    
    strings:
        $api1 = "VirtualAlloc" ascii
        $api2 = "CreateProcessW" ascii
        $mz = { 4D 5A }
        $encrypted = { 68 ?? ?? ?? ?? E8 }
    
    condition:
        $mz at 0 and 
        all of ($api*) and 
        #encrypted > 5
}
```

### Step 3: Dynamic Analysis

```text
Sandbox Setup:
├── Isolated VM (VirtualBox, VMware)
├── Network monitoring (Wireshark, INetSim)
├── Process monitoring (Procmon, Process Hacker)
├── Registry monitoring (Regshot)
├── File system monitoring (Noriben)
└── API monitoring (API Monitor)

Online Sandboxes:
├── Any.Run (https://any.run)
├── Hybrid Analysis (https://hybrid-analysis.com)
├── Joe Sandbox (https://joesandbox.com)
└── VirusTotal (https://virustotal.com)
```

```bash
# Fakenet-NG for network simulation
fakenet

# Process monitoring
procmon /AcceptEula /BackingFile capture.pml

# API tracing
drltrace -logdir . -- malware.exe
```

### Step 4: Code Analysis (Reverse Engineering)

```text
Disassembly Tools:
├── IDA Pro / IDA Free
├── Ghidra (free, NSA)
├── Radare2 / Cutter
├── Binary Ninja
└── x64dbg (debugger)
```

```python
# Python script to extract config from malware
import pefile
import struct

def extract_config(filepath):
    pe = pefile.PE(filepath)
    
    # Find .data or .rdata section
    for section in pe.sections:
        if b'.data' in section.Name:
            data = section.get_data()
            # Look for C2 pattern
            # Implementation depends on malware family
            
    return config
```

### Step 5: IOC Extraction

```yaml
# IOC Report Format
indicators:
  file_hashes:
    - type: sha256
      value: "a1b2c3d4..."
      description: "Main payload"
  
  network:
    - type: domain
      value: "malicious-c2.com"
      description: "C2 server"
    - type: ip
      value: "192.168.1.100"
      description: "Backup C2"
  
  file_paths:
    - value: "C:\\Users\\Public\\update.exe"
      description: "Dropped payload"
  
  registry:
    - value: "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Updater"
      description: "Persistence mechanism"

mitre_attack:
  - T1059.001  # PowerShell
  - T1055.001  # Process Injection
  - T1547.001  # Registry Run Keys
```

## Best Practices

### ✅ Do This

- ✅ Always analyze in isolated environment (VM or sandbox)
- ✅ Take snapshots before executing malware
- ✅ Document everything: hashes, behavior, network activity
- ✅ Correlate findings with threat intelligence
- ✅ Create detection rules (YARA, Sigma) from analysis

### ❌ Avoid This

- ❌ Never analyze on production or personal machines
- ❌ Don't connect analysis VM to corporate network
- ❌ Don't share unpacked malware samples publicly
- ❌ Don't skip static analysis—always do before dynamic
- ❌ Don't trust file extensions—verify with magic bytes

## Common Pitfalls

**Problem:** Malware detects VM and won't run
**Solution:** Use anti-VM evasion: remove VM tools, modify registry, use bare metal analysis.

**Problem:** Packed/obfuscated binary
**Solution:** Run dynamically to dump unpacked code from memory, or use automatic unpackers.

## Related Skills

- `@ctf-competitor` - Reverse engineering practice
- `@forensic-investigator` - Incident response context
- `@red-team-operator` - Understanding attacker techniques
- `@senior-cybersecurity-engineer` - Detection engineering
